---
description: "AI Workflow Engine - Validation and ERROR HANDLING (MANDATORY)"  
globs: "**/*"
alwaysApply: true
priority: 3
version: 2.1.4
tags: [workflow, validation, error-handling, quality, commits, mandatory]
---

# âœ… VALIDATION ENFORCEMENT

âš ï¸  **CRITICAL:** Validation is MANDATORY before commits (alwaysApply: true)

## ğŸš« NEVER Suggest Commits Without Validation

### Before ANY git commit suggestion:

**Step 1: Check Prerequisites**
```
1. Current state must be: READY_TO_COMMIT
   If not â†’ Help progress through states first
   
2. No .ai-context/WARNINGS.md file
   If exists â†’ Fix warnings first
```

**Step 2: Run Validation**
```bash
npx ai-workflow validate
```

**Step 3: Check Result**
```
Exit code 0 â†’ âœ… Safe to commit
Exit code â‰  0 â†’ âŒ Fix issues first
```

### If Validation Passes

**Safe to suggest:**
```
âœ“ Validation passed! Ready to commit:

git add .
git commit -m "feat: [description]"

# After commit
npx ai-workflow task complete
```

### If Validation Fails

**DON'T suggest commit. Instead:**

```
âŒ Validation failed. Issues found:
[List validation errors]

Let me help fix these issues:
[Suggest specific fixes]

After fixes, I'll validate again.
```

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

## âŒ FORBIDDEN COMMIT SUGGESTIONS

**NEVER suggest these:**

```
âŒ git commit --no-verify
   Why: Bypasses validation and quality gates

âŒ git commit -m "WIP" or "temp" or "quick fix"
   Why: Indicates work not complete

âŒ Suggesting commit when state â‰  READY_TO_COMMIT
   Why: Quality gates not met

âŒ Suggesting commit without running validation
   Why: Unknown issues might exist

âŒ Suggesting commit with active warnings
   Why: Blockers must be resolved first
```

## âœ… SAFE COMMIT CHECKLIST

Before suggesting ANY commit, verify:

- [ ] Current state = READY_TO_COMMIT (from STATUS.txt)
- [ ] No WARNINGS.md file exists
- [ ] Ran: npx ai-workflow validate
- [ ] Validation exit code = 0
- [ ] All tests passing
- [ ] Requirements satisfied

**Only when ALL checkboxes checked â†’ Safe to suggest commit**

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

## ğŸ”„ Validation Workflow

```
User: "Is this ready to commit?"

You:
  1. Check current state
     State: REVIEWING â†’ Not yet READY_TO_COMMIT
     
  2. Response:
     "Not quite ready. Let me run validation:
      npx ai-workflow validate"
      
  3. Run validation (simulate or ask user to run)
  
  4a. If passes:
      "âœ“ Validation passed! Progressing to READY_TO_COMMIT.
       Now safe to commit."
       
  4b. If fails:
      "âŒ Found issues: [list]
       Let me help fix these before committing."
```

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

## ğŸ’¡ WHY THIS MATTERS

**Without validation:**
- Untested code committed â†’ Bugs in production
- Incomplete work committed â†’ Technical debt
- Quality gates bypassed â†’ Compliance issues

**With validation:**
- Tested code only â†’ Quality assured
- Complete work only â†’ No debt
- Quality gates enforced â†’ Compliance met

**Validation is the LAST LINE OF DEFENSE.**

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

**This rule uses alwaysApply: true**  
**Validation is MANDATORY before commits**  
**Protects code quality and prevents regressions**

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

## ğŸš¨ ERROR HANDLING - MANDATORY (Added v2.1.4)

âš ï¸  **CRITICAL:** This section applies to EVERY command execution

### After EVERY Command (Not Just Validate)

**You MUST follow these steps after running ANY ai-workflow command:**

#### Step 1: Check Exit Code

**Execute command and check result:**

```bash
$ npx ai-workflow [command]
$ echo $?  # Check exit code immediately
```

**Exit Code Interpretation:**
```
Exit 0 = Success â†’ Proceed to Step 2 (verify outcome)
Exit 1 = Error â†’ STOP immediately, investigate (Step 4)
```

#### Step 2: Verify Expected Outcome (If Exit 0)

**Ask yourself:**
- Did the command achieve its intended goal?
- Did task state change as expected?
- Are files created/updated correctly?
- Does the result make sense?

**Check specific outcomes:**
```bash
# After task create:
$ cat .ai-context/current-task.json  # Task exists?

# After sync --state:
$ npx ai-workflow task status  # State changed?

# After validate:
# Did it say "âœ… Validation passed"?
```

#### Step 3: Sanity Check

**Before declaring success, verify:**
- âœ… Exit code is 0
- âœ… No error messages in output
- âœ… Expected changes occurred
- âœ… No warnings or anomalies
- âœ… Result makes logical sense

**Only if ALL checks pass â†’ Safe to declare success**

#### Step 4: Investigate Errors (If Exit â‰  0)

**When you see non-zero exit code:**

```
ğŸš¨ STOP IMMEDIATELY!

1. Read error message carefully
2. Understand what failed
3. Check system state:
   $ npx ai-workflow task status
   $ cat .ai-context/current-task.json
4. Explain situation to user
5. Suggest fix or ask for guidance
6. DO NOT continue until resolved
```

### Common Commands - What to Check:

#### Command: `task create`

```bash
$ npx ai-workflow task create "Goal"
$ echo $?

If 0:
  âœ… Check: cat .ai-context/current-task.json
  âœ… Verify: Task ID and goal present
  âœ… Then: "Task created successfully"
  
If 1:
  âŒ Error (probably: task already exists)
  âŒ Check: Is there an existing task?
  âŒ Action: Complete existing task first OR use --force
```

#### Command: `task complete`

```bash
$ npx ai-workflow task complete
$ echo $?

If 0 (Success):
  Case 1: Task just completed
    âœ… "Task completed successfully"
    âœ… Task status = 'completed'
    âœ… completedAt timestamp exists
  
  Case 2: Task already completed (v2.1.5+)
    âœ… "Task already completed!" (not an error!)
    âœ… Shows task info & duration
    âœ… Suggests creating new task
  
If 1 (Error):
  âŒ Error: Truly no task exists
  âŒ Check: npx ai-workflow task status
  âŒ Action: Create task first OR ensure at READY_TO_COMMIT state
  
Note: Exit 0 for "already completed" is by design (v2.1.5+)
```

#### Command: `sync --state`

```bash
$ npx ai-workflow sync --state TESTING
$ echo $?

If 0:
  âœ… Check: Task state is now TESTING
  âœ… Verify: State history updated
  âœ… Then: "State updated successfully"
  
If 1:
  âŒ Error (probably: invalid transition OR missing phases)
  âŒ Read: Error message explains why
  âŒ Action: Follow sequential progression OR complete missing phases
```

#### Command: `validate`

```bash
$ npx ai-workflow validate
$ echo $?

If 0:
  âœ… "All validations passed"
  âœ… Safe to progress to READY_TO_COMMIT
  âœ… Safe to commit
  
If 1:
  âŒ "Validation failed"
  âŒ Read: What validations failed
  âŒ Action: Fix issues before committing
```

#### Command: `sync` (no --state)

```bash
$ npx ai-workflow sync
$ echo $?

If 0:
  âœ… "Workflow complete and synchronized"
  âœ… No missing phases
  âœ… Context files updated
  
If 1:
  âŒ "WORKFLOW INCOMPLETE"
  âŒ Missing phases detected
  âŒ Action: Follow AI Flow Correction instructions
  âŒ Complete missing phases before continuing
```

### NEVER Do This:

```
âŒ BAD - Ignoring Exit Code:
$ npx ai-workflow task complete
âœ… Task already completed!
$ echo $?
0
âŒ Error: Task failed!  â† WRONG! Exit code was 0 (success)!

âŒ BAD - Not Checking Exit Code:
$ npx ai-workflow sync --state INVALID
[See error message but don't check exit code]
âœ… State updated!  â† WRONG! Didn't verify!

âŒ BAD - Declaring Success Without Verification:
$ npx ai-workflow validate
âœ… Validation passed!  â† Did you actually check the output?
```

### ALWAYS Do This:

```
âœ… GOOD - Proper Status Checking:
$ npx ai-workflow task complete
âœ… Task already completed!
$ echo $?
0

ğŸ¤– Analysis:
  Exit code: 0 (success)
  Message: "Task already completed"
  
  Checking details...
  $ npx ai-workflow task status
  âœ… Task Completed
  Goal: Previous task
  Duration: 2h 30m
  
  Status: Task was successfully completed earlier
  
  Action: Create new task for new work
  $ npx ai-workflow task create "Next task"
  
âœ… GOOD - Handling True Errors:
$ npx ai-workflow task complete
âŒ Error: No active task to complete
$ echo $?
1

ğŸ¤– Analysis:
  Exit code: 1 (error)
  Message: "No active task to complete"
  
  Investigating...
  $ npx ai-workflow task status
  âš ï¸  No active task
  $ ls .ai-context/current-task.json
  No such file
  
  Root cause: No task file exists
  
  Action: Create task first
  $ npx ai-workflow task create "<goal>"
  
  I will NOT declare success until this is resolved.

âœ… GOOD - Verification Before Success:
$ npx ai-workflow sync --state TESTING
$ echo $?
0

ğŸ¤– Verification:
  Exit code: 0 âœ…
  
  Checking actual state...
  $ npx ai-workflow task status
  State: TESTING âœ…
  
  Verification complete. State successfully updated.
  âœ… Now declaring success.
```

### Quick Reference:

**Exit Code Meanings:**
- `0` = Success, command completed
- `1` = Error, command failed
- `2+` = Specific error codes (rare)

**When to Stop:**
- âš ï¸ Exit code â‰  0
- âš ï¸ Error message in output
- âš ï¸ Unexpected result
- âš ï¸ State didn't change
- âš ï¸ Files not updated
- âš ï¸ Something feels wrong

**When to Continue:**
- âœ… Exit code = 0
- âœ… Success message shown
- âœ… Expected outcome verified
- âœ… State/files updated correctly
- âœ… Everything makes sense

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

## ğŸ’¡ WHY ERROR HANDLING MATTERS

**Without checking exit codes:**
- AI ignores command failures
- AI declares false success
- Workflow becomes corrupted
- Quality gates bypassed
- User confused by AI behavior

**With proper error handling:**
- AI detects failures immediately
- AI investigates before continuing
- Workflow stays correct
- Quality maintained
- User trusts AI behavior

**Error handling is as important as validation itself.**

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

**This rule uses alwaysApply: true**  
**Error handling is MANDATORY for ALL commands**  
**Prevents false success declarations and workflow corruption**  
**Updated: v2.1.4-hotfix**
